# Jujutsu Journaling (jjj)

jujutsuで文書の変更履歴を自動記録する拡張機能

## 機能

- Git管理フォルダの自動検出
- 編集内容の自動コミット・プッシュ（ファイル更新が1分間止まったら実行）
- 他メンバーの変更の自動取得
- 手動同期トリガー（Ctrl+Shift+S / Cmd+Shift+S）
- コンフリクト状態での保存対応

## 前提条件

- **jujutsu (jj)** がインストールされていること
  - インストール方法: https://github.com/martinvonz/jj#installation
  - `jj --version` でバージョンが表示されることを確認してください
- Git管理されたワークスペースを開いていること
- リモートリポジトリが設定されていること

## 推奨設定

自動保存を有効化することを推奨します:

```json
{
  "files.autoSave": "afterDelay",
  "files.autoSaveDelay": 1000
}
```

## 使い方

1. Git管理されたフォルダをCursorで開く
2. 拡張機能が自動的に同期を開始
3. ファイルを編集・保存すると自動的にコミット・プッシュされる
4. 手動同期: コマンドパレットから「JJJ: 今すぐ同期」を実行

## 自動同期の詳細動作

### 変更検出メカニズム
1. ファイル保存時にデバウンスタイマー（1分）を開始
2. 1分間変更がないとき、`processQueue()`が発火
3. **実際に変更があるかを確認**（`jj status`で判定）
4. 変更がある場合のみコミット・プッシュを実行
5. 変更がない場合は同期をスキップ

### キューと変更の乖離
エディタでファイルを保存しても、実際の内容が変わらないケースがあります：
- 自動保存で同じ内容が再保存された
- 保存後にすぐ編集内容をrevertした
- 一時的な変更を取り消した

このような場合、キューにはファイルが残っていても`jj status`では変更なしと判定されます。
拡張機能は実際の変更のみをコミットするため、不要なコミットが作られることはありません。

### ログ出力
変更がない場合は以下のようにログに記録されます：
```
[INFO] No uncommitted changes found. Skipping auto-commit (queue had 3 files)
```

## コマンド

- `JJJ: 今すぐ同期` - 手動で同期を実行
- `JJJ: 自動同期を有効化` - 自動同期を開始
- `JJJ: 自動同期を無効化` - 自動同期を停止

## 設定

- `jjj.autoSyncEnabled` (boolean, デフォルト: true) - 自動同期を有効化

## トラブルシューティング

### 「jjが見つかりません」というエラーが表示される

jujutsuがインストールされていないか、PATHに追加されていません。
以下を確認してください:

1. jujutsuがインストールされていること
2. ターミナルで `jj --version` が実行できること
3. Cursorを再起動してPATHを再読み込み

### 同期が動作しない

1. ステータスバーの表示を確認してください
2. Git管理されたフォルダを開いていることを確認してください
3. リモートリポジトリが設定されていることを確認してください

## ライセンス

MIT
